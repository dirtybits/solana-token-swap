# Solana Token Swap Escrow

A decentralized token swap program built on Solana with a modern React frontend.

## Features

- **Trustless token swaps** - Create offers to swap tokens without intermediaries
- **Secure escrow** - Tokens locked in program-controlled vault
- **Modern UI** - Clean, glassmorphism design with Solana branding
- **Auto token detection** - Supports both Token Program and Token-2022
- **Transaction history** - Track all your swaps on-chain
- **Full TypeScript** - Type-safe client generated by Codama

## Tech Stack

**Program:**
- Anchor 0.31.1
- Rust with SPL Token support
- Token Extensions (Token-2022) compatible

**Client:**
- Codama-generated TypeScript client (Kit v2)
- React 18 + TypeScript
- Wallet Adapter for Phantom/Solana wallets
- Vite for fast dev experience

## Quick Start

### Prerequisites

- Solana CLI 2.1+
- Anchor 0.31+
- Node.js 20+
- Rust 1.80+

### Installation

```bash
# Clone the repo
git clone <your-repo-url>
cd swap-program

# Install dependencies
npm install

# Install frontend dependencies
cd frontend-example
npm install
cd ..
```

### Configuration

**Frontend config:**
Update `frontend-example/src/config.ts` with your token addresses after creating them.

### Development

```bash
# Run tests
anchor test

# Build program
anchor build

# Regenerate TypeScript client after program changes
npm run regenerate-client

# Start frontend
cd frontend-example && npm run dev
```

### Deployment

**Testnet:**
```bash
# Switch to testnet
solana config set --url testnet

# Get testnet SOL
solana airdrop 2

# Deploy
anchor deploy

# Update program ID in programs/escrow/src/lib.rs
# Then rebuild and regenerate client
anchor build
npm run regenerate-client

# Upload IDL
anchor idl init --filepath target/idl/escrow.json <PROGRAM_ID>
```

**Create test tokens:**
```bash
# Token-2022 with metadata (named tokens)
npx tsx scripts/create-named-token.ts

# Regular tokens (no metadata)
npx tsx scripts/setup-test-tokens.ts
```

## Program Instructions

**make_offer** - Create a new token swap offer
- Locks your tokens in an escrow vault
- Specifies what tokens you want in return

**take_offer** - Accept someone's offer
- Sends your tokens to the offer maker
- Receives the escrowed tokens
- Closes the vault and offer accounts

**refund_offer** - Cancel your own offer
- Returns your tokens from the vault
- Closes the vault and offer accounts
- Only callable by the offer maker

## Project Structure

```
swap-program/
├── programs/escrow/          # Anchor program (Rust)
│   └── src/
│       ├── handlers/         # Instruction handlers
│       ├── state/           # Account structures
│       └── error.rs         # Custom errors
├── tests/                   # TypeScript tests
├── dist/js-client/          # Generated client (auto-generated)
├── frontend-example/        # React web app
│   └── src/
│       ├── components/      # UI components
│       └── styles.ts        # Shared styles
└── scripts/                 # Utility scripts
```

## Frontend Usage

The frontend connects to testnet by default. Update `App.tsx` to change networks.

**Create an offer:**
1. Connect your wallet
2. Select tokens from dropdown
3. Enter amounts
4. Click "Create Offer"

**Take an offer:**
- Click "Take Offer" on any listed offer
- Requires sufficient balance of the wanted token

**Refund an offer:**
- Your own offers show "Refund Offer" button
- Returns your tokens and closes the offer

## Development Notes

- Program ID is in `programs/escrow/src/lib.rs` (`declare_id!`)
- Frontend auto-detects Token Program vs Token-2022
- Transaction history stored in localStorage
- All times in UTC

## Security Considerations

⚠️ **This is a learning project. For production:**
- Add comprehensive error handling
- Implement rate limiting
- Add offer expiration
- Audit the program
- Test extensively on devnet/testnet

## License

MIT

## Contributing

Contributions welcome! Please open an issue or PR.

## Resources

- [Anchor Documentation](https://www.anchor-lang.com/docs)
- [Solana Cookbook](https://solanacookbook.com/)
- [Codama Docs](https://github.com/codama-idl/codama)
